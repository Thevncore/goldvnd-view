<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Gold Price Chart</title><script src="https://cdn.jsdelivr.net/npm/chart.js"></script><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script><style> .chart-container { width: 95vw; margin: 20px auto; } canvas { width: 100%; } h1, h3, h5 { text-align: center; } </style></head><body><div class="container-fluid py-3 d-flex flex-column gap-3"><div class="container-fluid d-flex flex-column gap-3 px-0"><div class="row gy-3"><div class="col-12 col-md-12 col-lg-12"><div class="card shadow"><h5 class="card-header">Giá hiện tại</h5><div class="card-body"><div class="row"><div class="col"><h5>MUA</h5><h3 id="current-buy-price" class="fw-bold"></h3></div><div class="col"><h5>BÁN</h5><h3 id="current-sell-price" class="fw-bold"></h3></div></div></div></div></div><div class="col-12 col-md-6 col-lg-4"><div class="card shadow"><h5 class="card-header">Chênh lệch hôm nay</h5><div class="card-body"><div class="chart-container w-100"><h1 id="today-fluctuations" class="fw-bold"></h1></div></div></div></div><div class="col-12 col-md-6 col-lg-4"><div class="card shadow"><h5 class="card-header">Chênh lệch hôm qua</h5><div class="card-body"><div class="chart-container w-100"><h1 id="1day-fluctuations" class="fw-bold"></h1></div></div></div></div><div class="col-12 col-md-6 col-lg-4"><div class="card shadow"><h5 class="card-header">Chênh lệch tuần qua</h5><div class="card-body"><div class="chart-container w-100"><h1 id="1week-fluctuations" class="fw-bold"></h1></div></div></div></div></div></div><div class="card shadow"><h5 class="card-header">Main index</h5><div class="card-body"><div class="chart-container w-100"><canvas id="goldPriceChart"></canvas></div></div></div></div><script> function calculateFluctuations(data, startDate, endDate) { /* * Set startDate and endDate to the beginning and end of the day respectively */ startDate.setHours(0, 0, 0, 0); endDate.setHours(23, 59, 59, 999); /* * Filter the data to include only items within the specified date range */ const filteredData = data.filter(item => { const itemDate = item.Date; return itemDate >= startDate && itemDate <= endDate; }); /* * Sort the filtered data by date in ascending order */ filteredData.sort((a, b) => a.Date - b.Date); /* console.log(startDate, endDate, filteredData.map(item => item.Date.toLocaleDateString('vi-VN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', }))); */ /* * If there is no data or only one data point, return 0 as the fluctuation */ if (filteredData.length === 0 || filteredData.length === 1) { return 0; } /* * Calculate fluctuations as the difference between the highest and lowest buyValue */ const minBuyValue = Math.min(...filteredData.map(item => item.BuyValue)); const maxBuyValue = Math.max(...filteredData.map(item => item.BuyValue)); /*console.log(minBuyValue, maxBuyValue, filteredData.map(item => item.BuyValue));*/ return maxBuyValue - minBuyValue; } function updateFluctuationElement(elementId, fluctuation) { /* * Update the DOM element with the fluctuation value and apply styling based on the value */ const element = document.getElementById(elementId); element.innerText = ` ${fluctuation.toLocaleString('en-US')} VND`; if (fluctuation > 0) { element.style.color = 'green'; } else if (fluctuation < 0) { element.style.color = 'red'; } else { element.style.color = 'black'; } } const canvas = document.getElementById('goldPriceChart'); /* * Adjust canvas size on window resize */ function resizeCanvas() { canvas.style.width = canvas.width = (window.innerWidth) + 'px'; canvas.style.height = canvas.height = window.innerHeight + 'px'; } window.addEventListener('resize', resizeCanvas); resizeCanvas(); /* Initial resize */ /* * Define `toDateValue` with DD/MM/YYYY format of today's date */ const today = new Date(); const toDateValue = `${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`; /* * Define `fromDateValue` with DD/MM/YYYY format of 30 days before today */ const fromDate = new Date(today); fromDate.setDate(today.getDate() - 30); const fromDateValue = `${String(fromDate.getDate()).padStart(2, '0')}/${String(fromDate.getMonth() + 1).padStart(2, '0')}/${fromDate.getFullYear()}`; fetch("https://sjc.com.vn/GoldPrice/Services/PriceService.ashx", { "referrer": "https://sjc.com.vn/bieu-do-gia-vang", "referrerPolicy": "strict-origin-when-cross-origin", "body": `method=GetGoldPriceHistory&goldPriceId=33&fromDate=${fromDateValue}&toDate=${toDateValue}`, "method": "POST", "mode": "cors", "credentials": "omit" }).then(response => response.json()) .then(data => { /* * Get the current price from the last item in the data array */ const currentBuyPrice = data.data[data.data.length - 1].BuyValue; const currentBuyPriceElement = document.getElementById('current-buy-price'); currentBuyPriceElement.innerText = `${currentBuyPrice.toLocaleString('en-US')} VND`; const currentSellPrice = data.data[data.data.length - 1].SellValue; const currentSellPriceElement = document.getElementById('current-sell-price'); currentSellPriceElement.innerText = `${currentSellPrice.toLocaleString('en-US')} VND`; /* * Iterate over the data and convert GroupDate to a Date object */ data.data.forEach(item => { try { item.Date = new Date(parseInt(item.GroupDate.match(/\d+/)[0])); } catch (error) { console.error('Error parsing GroupDate:', error); } }); const chartData = data.data.map(item => ({ buyValue: item.BuyValue, sellValue: item.SellValue, groupDate: new Date(parseInt(item.GroupDate.match(/\d+/)[0])).toLocaleDateString('vi-VN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit', second: '2-digit', }) })); /* * Extract data for the chart */ const labels = chartData.map(item => item.groupDate); const buyValues = chartData.map(item => item.buyValue); const sellValues = chartData.map(item => item.sellValue); /* * Create the chart */ const ctx = canvas.getContext('2d'); new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [ { label: 'Buy', data: buyValues, borderColor: 'blue', backgroundColor: 'rgba(0, 0, 255, 0.1)', fill: true }, { label: 'Sell', data: sellValues, borderColor: 'red', backgroundColor: 'rgba(255, 0, 0, 0.1)', fill: true } ] }, options: { responsive: true, plugins: { legend: { position: 'top' }, tooltip: { mode: 'index', intersect: false } }, scales: { x: { title: { display: true, text: 'Date' } }, y: { title: { display: true, text: 'Value (VND)' } } } } }); /* * Calculate today's fluctuations */ const todayFluctuations = calculateFluctuations(data.data, today, today); updateFluctuationElement('today-fluctuations', todayFluctuations); /* * Calculate 1-day fluctuations (yesterday) */ const yesterday = new Date(today); yesterday.setDate(today.getDate() - 1); const oneDayFluctuations = calculateFluctuations(data.data, yesterday, yesterday); updateFluctuationElement('1day-fluctuations', oneDayFluctuations); /* * Calculate 1-week fluctuations (last 7 days) */ const oneWeekAgo = new Date(today); oneWeekAgo.setDate(today.getDate() - 7); const oneWeekFluctuations = calculateFluctuations(data.data, oneWeekAgo, today); updateFluctuationElement('1week-fluctuations', oneWeekFluctuations); }) </script></body></html>
